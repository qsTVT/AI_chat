{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>猫娘聊天系统</title>
    <script src="{% static 'js/vue.min.js' %}"></script>
    <script src="{% static 'js/index.js' %}"></script>
    <script src="{% static 'js/axios.min.js' %}"></script>
    <link href="{% static 'css/index.css' %}" rel="stylesheet">
    <link href="{% static 'css/element-icons.css' %}" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #E0FFFF 0%, #F0F8FF 100%);
            font-family: "Comic Sans MS", "Chalkboard SE", "Soft", sans-serif;
        }
        .home-container {
            width: 980px;
            max-width: 94%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(100, 149, 237, 0.2);
            display: flex;
            overflow: hidden;
            height: 68vh;
            min-height: 480px;
            border: 2px solid #B0C4DE;
        }
        .home-left {
            flex: 1;
            padding: 18px 18px;
            background: linear-gradient(180deg, #F0F8FF 0%, #E6E6FA 100%);
            color: #5c5c5c;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .home-left-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #4B0082;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }
        .home-left-subtitle {
            font-size: 13px;
            opacity: 0.9;
            line-height: 1.6;
        }
        .home-left-footer {
            font-size: 11px;
            opacity: 0.85;
        }
        .home-right {
            flex: 1.6;
            padding: 24px 24px;
        }
        .home-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #FF69B4;
            text-align: center;
        }
        .home-subtitle {
            font-size: 12px;
            color: #FF99AC;
            text-align: center;
            margin-bottom: 16px;
        }
        .section-title {
            font-size: 14px;
            color: #606266;
            margin: 16px 0 8px;
            font-weight: 500;
        }
        .btn-row {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        .btn-row .el-button {
            width: 48%;
        }
        .error-text {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 4px;
            min-height: 18px;
        }
        .home-actions {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
            margin-top: 12px;
        }
        .home-actions .el-button {
            width: 100%;
            margin: 0;
            border-radius: 12px !important;
            border: none !important;
            font-weight: bold;
        }
        
        .el-button--primary {
            background-color: #87CEFA !important;
            color: white !important;
        }
        .el-button--primary:hover {
            background-color: #00BFFF !important;
        }
        
        .el-button--danger {
            background-color: #FFB6C1 !important;
            color: white !important;
        }
        .el-button--danger:hover {
            background-color: #FF69B4 !important;
        }
        
        .el-button--warning {
            background-color: #DDA0DD !important;
            color: white !important;
        }
        .el-button--warning:hover {
            background-color: #BA55D3 !important;
        }
        
        .el-button--success {
            background-color: #98FB98 !important;
            color: white !important;
        }
        .el-button--success:hover {
            background-color: #3CB371 !important;
        }

        .frame-wrapper {
            margin-top: 20px;
            border: 1px solid #FFC0CB;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(255, 182, 193, 0.2);
        }
        .frame-toolbar {
            background: #FFF0F5;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #FFC0CB;
        }
        .frame-title {
            font-size: 14px;
            color: #FF69B4;
        }
        .frame-content {
            height: calc(68vh - 64px);
            background: #fff;
        }
        .frame-content iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 999;
            display: flex;
            flex-direction: column;
        }
        .overlay-toolbar {
            height: 48px;
            background: #FFF0F5;
            border-bottom: 1px solid #FFC0CB;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
        }
        .overlay-title {
            font-size: 14px;
            color: #FF69B4;
            font-weight: bold;
        }
        .overlay-content {
            flex: 1;
            background: #fff;
        }
        .overlay-content iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }
    </style>
</head>
<body>
<div id="homeApp" class="home-container">
    <div class="home-left">
        <div style="text-align:center;">
            <div class="home-left-title" style="margin-top:6px;">欢迎使用猫娘AI聊天机器人</div>
            <div class="home-left-subtitle" style="margin-top:6px;opacity:0.95;">请登录使用</div>
            <div class="home-actions" style="margin-top:16px;">
                <el-button v-if="!isAuthed" type="primary" @click="goLogin">登录</el-button>
                <el-button v-else type="danger" @click="logout">退出登录</el-button>
                <el-button type="warning" @click="goRegister">注册</el-button>
                <el-button type="success" @click="goChat">进入聊天</el-button>
                <el-button type="danger" @click="goAdmin">管理员模式</el-button>
            </div>
        </div>
        <div class="home-left-footer">
        </div>
    </div>
    <div class="overlay" v-if="frameSrc">
        <div class="overlay-toolbar">
            <div class="overlay-title">{{ frameTitle }}</div>
            <div>
                <el-button size="mini" @click="closeFrame">关闭</el-button>
            </div>
        </div>
        <div class="overlay-content">
            <iframe :src="frameSrc"></iframe>
        </div>
    </div>
</div>
<script>
    new Vue({
        el: '#homeApp',
        data: function () { return { frameSrc: '', frameTitle: '', isAuthed: false, user: null } },
        mounted: function () {
            var that = this
            window.addEventListener('message', function (evt) {
                var data = evt && evt.data
                if (data && data.action === 'close_overlay') {
                    that.closeFrame()
                }
            })
            this.checkAuth()
        },
        methods: {
            goLogin: function () {
                window.location.href = '/page/login/'
            },
            goRegister: function () {
                window.location.href = '/page/register/'
            },
            goAdmin: function () {
                window.location.href = '/page/admin/login/'
            },
            goChat: function () {
                if (this.isAuthed) {
                    window.location.href = '/page/answer/'
                } else {
                    alert('请登录')
                }
            },
            logout: function () {
                var that = this
                axios.post('/api/logout/').then(function (res) {
                    that.isAuthed = false
                    that.user = null
                    alert(res.data && res.data.msg || '已退出登录')
                }).catch(function () {
                    alert('退出失败，请稍后再试')
                })
            },
            checkAuth: function () {
                var that = this
                axios.get('/api/me/').then(function (res) {
                    var data = res.data
                    if (data && data.code === 200 && data.data) {
                        that.isAuthed = true
                        that.user = data.data
                    } else {
                        that.isAuthed = false
                        that.user = null
                    }
                }).catch(function () {
                    that.isAuthed = false
                    that.user = null
                })
            },
            closeFrame: function () {
                this.frameSrc = ''
                this.frameTitle = ''
            }
        }
    })
</script>
</body>
</html>
